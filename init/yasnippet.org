#+title: Yasnippet configuration

* Lexical binding

  #+BEGIN_SRC emacs-lisp :padline no
    ;; -*- lexical-binding: t -*-
  #+END_SRC

* Enabled modules

  I don't want to enable yasnippet everywhere, because it rebinds TAB
  in a way that is not suitable for everywhere, for example in shell
  sessions. I want it to be enabled in these modes :

  #+name: enabled-modules
  - php
  - js2

  The function ~my-add-yasnippet-hooks~ is in charge of adding
  ~yas-minor-mode~ for the above major modes.

  #+BEGIN_SRC emacs-lisp :var enabled-modules=enabled-modules
    (defun my-add-yasnippet-hooks ()
      "Add `yas-minor-mode' to the desired major mode hooks."
      (dolist (lang enabled-modules)
        (add-to-list (intern (concat lang "-mode-hook")) #'yas-minor-mode)))
  #+END_SRC

* Initialization

  I load yasnippet and add it to the required hooks.

  My emacs configuration is not always in =~/.emacs.d/= so I also
  tweak =yas-snippet-dirs= to load the sippets from the right place.

  #+BEGIN_SRC emacs-lisp
    (use-package yasnippet
      :ensure
      :defines (yas-snippet-dirs yas-installed-snippets-dir)
      :config (progn
                (setq yas-snippet-dirs (list (concat my-confdir "snippets/") 'yas-installed-snippets-dir))
                (yas-reload-all))
      :init (my-add-yasnippet-hooks))
  #+END_SRC
